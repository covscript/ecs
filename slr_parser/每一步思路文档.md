## ecs

目前项目结构
+ ***lsr_parse(dir)测试用***
	+ check_grammar.csc
	+ err1.txt
	+ parse_new_grammar.csp
+ ***source file(dir)输入输出文件***
	+ ecs.ebnf *(语法输入)*
	+ test.ecs *(源代码)*
	+ res.txt *(输出文件)*
+ parse_new_tree.csc *(主程序)*
+ parsergen.csp *(lexer, 文法的parser)*
+ ebnf_parser.csp *(文法parser规则)*
+ grammar_transfer.csp *(文法分析序列化)*
+ check_LR_grammar.csp *(LR分析，是否为LR、SLR语言)*
+ ecs_parser.csp *(slr分析+报错)*
### 目的

前端要求： 支持ecs语法，包括lexer， parser，生成语法树，并将语法树进行修饰，以达到兼容cov3的后端。
步骤要求:  使用parsergen，即所需要的lexer与parser

+ 总结
	+ 编译相关： 生成支持
	+ 报错相关：由于SLR的报错分析需要大量定制化，故现用错误回退的方式进行处理（详见后续描述）

### 步骤

#### 名词

+ 源码，即source code，指输入文件中的代码，作为编译器的输入内容(但并非输入参数)
+ 源文件，即source file，指编译器的输入(文件名)，体现为:` $ compiler file1 > file2 `，其中file1即为源文件
+ 输出文件， 即编译器的输出，在测试时会打印在某文件中便于调试，体现为上一条中的file2。
+ token，词素，指lexer中最小分割单位。
+ 待补充

#### ==lexer==

目前使用老版本的parsergen ~~(by mikecovlee)~~
值得注意的是，换行符ENDL一同被存入token。

输入:需要为该语言token提供正则表达式(集成在文件中)，输入为源码

输出:输出为tokens（若干对象，包括其位置pos，类型type和数据data）

目前状况：现条件稳定无bug，但若修改token规则，可能会导致正则表达式修改复杂（实际上实现时正则表示也是个难点），性能暂不做考察（lexer时间远低于parser或后端）

#### ==parser(ecs)==

老版本的parsergen主要用于解析ecs文件,从而能用ecs文件作为parsergen的输入,生成能分析tokens的parser.

输入: tokens

输出: AST

目前状况: 现主要用于生成ecs文件的AST(与编译用的源代码无直接关系)

#### ***Covscript AST Visitor Generator(非编译程序)***

用于生成grammar transfer

并非在编译程序中

输入:

输出 grammar_transfer.csp文件

目前状况: grammar_transfer文件不完善,还需要后续完善才能够使用. 

#### ==grammar transfer==

generated by Covscript AST Visitor Generator

输入: ecs语法树

输出: 线性的文法, tree_type对象,包括root, seq(分配名字时用), node

例: var_bind_list ::= ID | '...' | var_bind ;

->
	var_bind_list ::= ID;
	var_bind_list ::= '...';
	var_bind_list ::= var_bind;

目前状况:目前版本（已完善）功能无问题,但直接由AST生成时需要补充功能，即需要完善对应的ast visiter generator。

#### ==check_LR_grammar==

用于检测是否是LR文法

依次经过
+ 添加开始项
+ 计算first集
+ 计算follow集
+ 添加mark（分成LR项）
+ 扁平化
+ 创建NFA
+ 创建DFA
+ 检测文法是否符合LR、SLR规则（暂时是输出错误信息，未设置异常）
+ 

输入：文法

输出: 是否是slr文法

目前状况: 保留slr分析绝大多数信息,步骤较规范(参考编译原理步骤),但可继续拆分,目前该文件内对象比较混乱，待分化。

#### ==ecs_parser==

用于slr分析，即经过前几步得到的信息（如预测表等），经过双栈分析的方式进行parse，但目前报错思路较紊乱（第一个错误能识别，但第二个开始，利用栈的时候便有些出入）

报错思路：



输入： 源文件
输出： AST语法树

目前状况： slr基本分析没问题，但报错是个难点，目前报错方式仅是“凑数”，后续待压缩。


